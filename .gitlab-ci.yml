
stages:
  - lint
  - compile
  - test
  - build
  - publish

variables:
  CI_PROJECT_DIR_WINDOWS: "c:\\Users\\jeanl\\OneDrive\\Bureau\\IMMO-SCRAPER"
  CI_PROJECT_DIR_LINUX: "/home/jean-louis/Bureau/IMMO-SCRAPER"

before_script:
  - python -m pip install --upgrade pip
  - pip install -r requirements.txt
  - |
    if [ "$(uname)" == "Linux" ]; then
      export DATABASE_PATH="$CI_PROJECT_DIR_LINUX/database/immoscraper.db"
    elif [ "$(uname)" == "Windows" ]; then
      export DATABASE_PATH="$CI_PROJECT_DIR_WINDOWS\\database\\immoscraper.db"
    else
      echo "Unsupported OS"
      exit 1
    fi

lint:
  stage: lint
  image: python:3.9
  script:
    - pip install flake8
    - flake8 . 

# unit_tests:
#   stage: test
#   image: python:3.9 
#   script:
#     - export DATABASE_PATH="$CI_PROJECT_DIR\\database\\immoscraper.db"
#     - python -m unittest discover -s tests -p 'test_*.py'

build:
  stage: build
  image: centos:latest
  script:
    - set -x
    - yum update
    - yum -y install epel-release
    - yum install -y python3 python3-pip rpm python3-dev python3-setuptools
    - /usr/bin/python3 -m pip install --upgrade pip
    - /usr/bin/python3 -m pip install setuptools wheel
    - /usr/bin/python3 setup.py sdist bdist_wheel
    - yum install tree
    - tree
    - cd /root
    - tree
    - rpmbuild -ba --verbose /builds/jeanlouisHERVE/immo-scraper/immoscraper.spec
  artifacts:
    paths:
      - immoscraper-*.rpm
      - rpmbuild.log

# publish:
#   stage: publish
#   script:
#     - echo "Publishing RPM to Artifactory"
#     # Add commands to publish the RPM to Artifactory here
#   only:
#     - tags  # This job runs only for tags, you can adjust this condition as needed
