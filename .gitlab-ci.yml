image: python:3.9 

stages:
  - lint
  - test
  - build
  - publish

before_script:
  - python -m pip install --upgrade pip
  - pip install -r requirements.txt

lint:
  stage: lint
  image: python:3.9
  script:
    - pip install flake8
    - flake8 . 

unit_tests:
  stage: test
  script:
    - $CI_PROJECT_DIR = "c:\\Users\\jeanl\\OneDrive\\Bureau\\IMMO-SCRAPER"
    - export DATABASE_PATH="$CI_PROJECT_DIR\\database\\immoscraper.db"
    - python -m unittest discover -s tests -p 'test_*.py'

build:
  stage: build
  script:
    - apt-get update
    - apt-get install -y rpm
    - pip install setuptools wheel
    - python setup.py sdist bdist_wheel
    - rpmbuild -ba immo-scraper.spec
  artifacts:
    paths:
      - immo-scraper-*.rpm

publish:
  stage: publish
  script:
    - echo "Publishing RPM to Artifactory"
    # Add commands to publish the RPM to Artifactory here
  only:
    - tags  # This job runs only for tags, you can adjust this condition as needed
